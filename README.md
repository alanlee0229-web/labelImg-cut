# LabelImg 增强版

LabelImg 增强版是一款专业的图像标注工具，在原版基础上添加了多种智能分割模式，大幅提升标注效率。

## 🚀 功能亮点

### 1. 多种标注模式

#### 固定区块模式（常规模式）
- **快捷键**：`Q`
- **功能**：传统矩形框标注，适合规则目标
- **默认启动模式**

#### 自定义选区模式
- **快捷键**：`E`
- **绘制方式**：按 `W` 开始，通过多次点击形成闭合多边形
- **特点**：精确选择任意形状区域，特别适合复杂边界目标
- **操作流程**：
  1. 按 `E` 切换模式
  2. 按 `W` 开始绘制
  3. 点击多次创建顶点
  4. 闭合多边形完成选区

### 2. 智能区域分割功能

#### 一键分割
- **快捷键**：`C`
- **触发条件**：在任意选区模式下选择区域后
- **功能**：自动将选中区域分割为多个小检测框

#### 优化分割算法
- **整行交错布局**：奇数行向右偏移区块宽度的50%
- **无重叠设计**：区块间保持适当间隙
- **智能筛选**：根据重叠度阈值保留有效区块
- **高效边界利用**：比传统网格布局更节省空间
- **全面角落覆盖**：优化算法确保所有角落区域都能被精确分割
- **智能区域识别**：自动区分普通区域和角落/边缘区域，应用差异化重叠度阈值
- **扩展网格范围**：向左上方扩展2个步长，向右下方扩展3个步长，确保完整覆盖

## 📁 项目结构

```
├── labelImg.py        # 主程序文件
├── libs/              # 核心功能模块
│   ├── canvas.py      # 画布处理
│   ├── shape.py       # 形状处理
│   ├── labelFile.py   # 标注文件处理
│   └── ...
├── data/              # 配置数据
│   └── predefined_classes.txt  # 预定义类别
├── resources/         # 图标和字符串资源
└── resources.qrc      # 资源配置文件
```

## 🛠️ 安装说明

### Windows 安装

1. 确保安装了 Python 3.x
2. 安装必要依赖：
   ```
   pip install PyQt5 lxml
   ```
3. 编译资源文件：
   ```
   pyrcc5 -o libs/resources.py resources.qrc
   ```
4. 运行程序：
   ```
   python labelImg.py
   ```

### Linux/Mac 安装

```bash
# 安装依赖
sudo apt-get install pyqt5-dev-tools  # Ubuntu/Debian
pip3 install -r requirements.txt  # 如果有requirements文件

# 运行程序
python3 labelImg.py
```

## 🎯 使用指南

### 基本操作流程

1. **打开图像**：
   - 点击菜单栏 `文件` → `打开` 或按 `Ctrl+O`
   - 或选择 `打开目录` 按 `Ctrl+U` 批量加载图像

2. **创建标注**：
   - 固定区块模式（`Q`）：点击并拖动创建矩形
   - 自定义选区模式（`E`）：按 `W` 绘制多边形

3. **批量处理**：
   - 在选中区域后按 `C` 进行智能分割
   - 使用 `Ctrl+D` 复制当前标注框

4. **保存标注**：
   - 按 `Ctrl+S` 保存当前图像标注
   - 按 `D` 跳转到下一张图像

### 高级功能

#### 全选删除功能
- **快捷键**：`Ctrl+Shift+A`
- **功能**：一键全选并删除当前图像中所有检测框
- **确认机制**：弹出确认对话框，默认选项为删除

#### 标注格式支持
- **PascalVOC**（XML格式）
- **YOLO**（TXT格式）
- **CreateML** 格式

通过工具栏按钮切换不同格式。

## ⌨️ 快捷键一览

| 快捷键 | 功能描述 |
|--------|----------|
| `Q` | 切换到固定区块模式 |
| `E` | 切换到自定义选区模式 |
| `W` | 在自定义选区模式下开始绘制 |
| `C` | 执行区域分割操作 |
| `Ctrl+Shift+A` | 全选并删除所有检测框 |
| `Ctrl+U` | 从目录加载所有图像 |
| `Ctrl+R` | 更改标注保存目录 |
| `Ctrl+S` | 保存标注 |
| `Ctrl+D` | 复制当前标签和框 |
| `D` | 下一张图像 |
| `A` | 上一张图像 |
| `Del` | 删除选中的框 |
| `Space` | 标记当前图像为已验证 |
| `Ctrl++` | 放大 |
| `Ctrl+-` | 缩小 |
| `↑→↓←` | 移动选中的框 |

## 🎨 实用技巧

### 场景一：批量标注规则排列目标
1. 使用 `Q` 模式框选整个区域
2. 按 `C` 执行智能分割
3. 快速检查并微调生成的检测框

### 场景二：精确标注不规则目标
1. 使用 `E` 模式进入自定义选区
2. 按 `W` 精确勾勒目标边界
3. 添加标签完成标注

### 场景三：清理杂乱标注
- 使用 `Ctrl+Shift+A` 快速清除所有标注
- 重新开始精准标注

## 📋 预定义类别

编辑 `data/predefined_classes.txt` 文件自定义类别列表，每行一个类别名称。

示例：
```
fog
building
car
person
```

## ❓ 常见问题

1. **如何切换标注格式？**
   - 点击工具栏上的格式按钮（PascalVOC/YOLO/CreateML）

2. **分割后的检测框可以调整吗？**
   - 是的，生成后可以像普通标注框一样拖动和调整

3. **自定义选区如何取消？**
   - 按 `ESC` 键取消正在绘制的多边形

4. **快捷键不生效怎么办？**
   - 确保输入法切换到英文状态
   - 检查是否有其他程序占用了相同快捷键

## 🖼️ 标注效果对比

### 传统手动标注
- 逐个创建检测框，耗时耗力
- 难以保证标注一致性

### 智能分割标注
- 一键生成多个检测框
- 布局优化，边界处理更高效
- 显著提升标注速度（最高可达5-10倍）

## 📄 许可证

本项目基于 MIT 许可证开源。